<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DoER Recruitment Form</title>
  <style>
    /* Reset and base styles */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 20px;
      background-color: #0E8D83;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      /* Allow the page to scroll if content exceeds viewport height */
      min-height: 100vh;
    }
    /* Container styles for both forms */
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      width: 350px;
      max-width: 90%;
      margin-bottom: 20px;
    }
    .container h2 {
      margin-top: 0;
    }
    input, select {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border: 2px solid #0E8D83;
      border-radius: 7px;
    }
    .next-button {
      background: #0E8D83;
      color: white;
      border: none;
      cursor: pointer;
      padding: 10px;
      width: 100%;
      margin-top: 20px;
      border-radius: 5px;
      font-size: 16px;
    }
    .next-button:hover {
      background: #09635b;
    }
    /* Styles for each question item */
    .question-item {
      margin-bottom: 15px;
      text-align: left;
    }
    .question-item label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- Student Form Section -->
  <div id="studentFormContainer" class="container">
    <h2>DoER Recruitment Form</h2>
    <input type="text" id="name" placeholder="Name" required />
    <input type="text" id="rollNumber" placeholder="Roll Number" required />
    <input type="text" id="course" placeholder="Course" required />
    <input type="text" id="batch" placeholder="Batch" required />
    <select id="roll">
      <option value="1styear">1st YEAR</option>
      <option value="2ndyear">2nd YEAR</option>
      <option value="3rdyear">3rd YEAR</option>
      <option value="4thyear">4th YEAR</option>
    </select>
    <button id="nextButton" class="next-button">Next</button>
  </div>

  <!-- Questions Form Section (hidden initially) -->
  <div id="questionsContainer" class="container" style="display: none;">
    <h2>Answer the Questions</h2>
    <form id="questionForm">
      <div id="questions"></div>
      <button type="submit" class="next-button">Submit</button>
    </form>
  </div>

  <!-- Firebase & Application Script -->
  <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-analytics.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-database.js";
    
    // Your Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB6pI97qLWk_f1MiEFsCFkA8c2xqMHfSaw",
      authDomain: "doer-recruitment.firebaseapp.com",
      projectId: "doer-recruitment",
      storageBucket: "doer-recruitment.firebasestorage.app",
      messagingSenderId: "800257233136",
      appId: "1:800257233136:web:9e57cc82599028eefc7235",
      measurementId: "G-6PT7W3BBG8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);

    // Global variable to hold student info
    let studentData = {};

    // Handle "Next" Button to Show Questions Form
    const nextButton = document.getElementById("nextButton");
    nextButton.addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      const rollNumber = document.getElementById("rollNumber").value.trim();
      const course = document.getElementById("course").value.trim();
      const batch = document.getElementById("batch").value.trim();
      const roll = document.getElementById("roll").value;

      if (!name || !rollNumber || !course || !batch) {
        alert("Please fill all fields.");
        return;
      }

      // Save student info
      studentData = { name, rollNumber, course, batch, roll };

      // Hide student form and display questions form
      document.getElementById("studentFormContainer").style.display = "none";
      document.getElementById("questionsContainer").style.display = "block";

      // Populate the questions form dynamically
      populateQuestions();
    });

    // List of Questions
    const questionsList = [
      "What is your favorite subject?",
      "What is your dream job?",
      "What motivates you to study?",
      "What is your favorite book?",
      "Who is your role model?",
      "What is your biggest achievement?",
      "What are your hobbies?",
      "What skill do you want to learn?",
      "What is your biggest challenge in studies?",
      "Where do you see yourself in 5 years?"
    ];

    // Function to Populate Questions
    function populateQuestions() {
      const questionsContainer = document.getElementById("questions");
      questionsContainer.innerHTML = ""; // Clear any existing content

      questionsList.forEach((question, index) => {
        const div = document.createElement("div");
        div.classList.add("question-item");
        div.innerHTML = `
          <label for="answer${index}">${question}</label>
          <input type="text" id="answer${index}" name="answer${index}" required />
        `;
        questionsContainer.appendChild(div);
      });
    }

    // Handle Questions Form Submission
    const questionForm = document.getElementById("questionForm");
    questionForm.addEventListener("submit", (event) => {
      event.preventDefault();

      // Collect answers from the form
      const formData = new FormData(questionForm);
      let answers = {};
      formData.forEach((value, key) => {
        answers[key] = value.trim();
      });

      // Merge student information with answers and add a timestamp
      const submissionData = {
        ...studentData,
        answers: answers,
        timestamp: new Date().toISOString()
      };

      // Write the submission to Firebase Realtime Database
      const submissionsRef = ref(database, "submissions");
      const newSubmissionRef = push(submissionsRef);
      set(newSubmissionRef, submissionData)
        .then(() => {
          alert("Answers submitted successfully!");
          window.location.reload(); // Optionally redirect or reset the forms
        })
        .catch((error) => {
          console.error("Error saving data:", error);
          alert("There was an error submitting your answers. Please try again.");
        });
    });
  </script>
</body>
</html>
